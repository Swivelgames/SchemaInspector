var SchemaInspector=function(){var f=function(a){this.options=a||{}};f.prototype={options:null,items:null,run:function(){this.items=[];return this.getItems()},getItems:function(){if(null!==this.items&&this.items instanceof Array&&0<this.items.length)return this.items;for(var a=document.querySelectorAll('[itemscope][itemtype]:not([itemtype=""])'),c=0;c<a.length;c++){var b=a[c];!0===SchemaUtilities.itemHasNoParent(b)&&this.items.push(this.parseItem(b))}return this.items},parseItem:function(a){return new SchemaItem(a)},
getOption:function(a){return this.options[a]||null},setOption:function(a,c){return this.options[a]=c}};return new f}();var SchemaItem=function(){var f=function(a){this.dom=a;this.init()};f.prototype={dom:null,type:null,schema:null,props:null,init:function(){var a=this.dom.getAttribute("itemtype");a||SchemaUtilities.log("error","Missing itemtype. May cause unexpected issues.");this.setSchema(a);this.props={};this.initProperties();return this},setSchema:function(a){this.schema=a;this.type=a.split(/\//).pop();return this},initProperties:function(){for(var a=this.dom.querySelectorAll("[itemprop]"),c=0;c<a.length;c++){var b=
a[c],d=SchemaUtilities.isPropInScope(b,this),e=b.getAttribute("itemprop");!0===d&&(d=this.props[e],b={value:this.parseProperty(b),dom:b},d instanceof Array?this.props[e].push(b):this.props[e]=d?[d,b]:b)}return this},parseProperty:function(a){return null!==a.getAttribute("itemscope")?SchemaInspector.parseItem(a):SchemaUtilities.getPropertyValue(a)}};return f}();var SchemaUI=function(){var f=function(){this.init()};f.prototype={tplDir:"./ui/",xhrCache:{},schemaContext:"/github/SchemaInspector/",inspectorDom:null,initialized:function(){var a=function(){};return a.prototype={vals:{},watchers:{},set:function(a,b){this.vals[a]=b;this.watchers[a]||(this.watchers[a]=[]);this.trigger(a)},watch:function(a,b){this.watchers[a].push(b)},trigger:function(a){var b=this.watchers[a];if(b)for(var d=0;d<b.length;d++)b[d].call(this,a,this.vals[a])}},new a}(),init:function(){this.initStyles();
var a=this,c=this.getTplDir();this.initialized.set("inspector",!1);this.loadResource(c+"inspector.html",function(b,c,e){this.inspectorDom=b[0];a.initInspector()});this.initialized.set("details",!1);this.initialized.set("list",!1);this.loadResource(c+"list.html",function(a,c,e){this.initList(a[0])})},displayInspector:function(){if(!document.body.querySelector("#schemaspacer")){var a=document.createElement("div");a.setAttribute("id","schemaspacer");document.body.appendChild(a)}document.body.appendChild(this.inspectorDom)},
initInspector:function(){var a=this,c=this.inspectorDom;this.initialized.watch("list",function(b,d){if(d){var e=c.querySelector("[data-placeholder-list]");e.parentNode.replaceChild(d,e);a.displayInspector()}});this.initialized.watch("details",function(b,d){if(d){var e=c.querySelector("[data-placeholder-details]");e.parentNode.replaceChild(d,e);this.vals.list&&a.displayInspector()}});c.querySelector("[data-button-hide]").addEventListener("click",function(){c.parentNode.removeChild(c)},!1);this.initialized.set("inspector",
!0)},initList:function(a){this.initialized.set("list",!1);this.setContent(a,"main",SchemaInspector,function(a,b){var d=this;this.loadResource(this.getTplDir()+"details.html",function(a){d.initDetails(a[0],b)})});this.initialized.set("list",a)},initDetails:function(a,c){this.initialized.set("details",!1);this.setContent(a,"details",c);this.initialized.set("details",a)},setContent:function(a,c,b,d){this.elementAttrMap(a,c,"prop",function(a,c){this.setElementValue(a,this.getPropFromStr(b,c))});this.elementAttrMap(a,
c,"list",function(a,c){this.populateList(a,this.getPropFromStr(b,c),d)})},populateList:function(a,c,b,d,e){var f=this,l=a.querySelector("[data-list-container]")||a;d||(d=a.querySelector("[data-list-item]"),d.parentNode.removeChild(d));for(var h in c){var k=c[h],g=d.cloneNode(!0,!1);k instanceof Array?this.populateList(a,k,b,d,h):(this.elementAttrMap(g,"list","key",function(a){this.setElementValue(a,e||h)}),this.elementAttrMap(g,"list","prop",function(a,b){this.setElementValue(a,this.getPropFromStr(k,
b))}),b instanceof Function&&g.addEventListener("click",function(a){return function(){var c=Array.prototype.splice.apply(arguments,[0]);b.apply(f,c.concat(a))}}([k,h,c,g,l,a,b])),l.appendChild(g))}},elementAttrMap:function(a,c,b,d){c="data-"+c+"-"+b;b=a.querySelectorAll("["+c+"]");if(!b||1>b.length)if(null!==a.getAttribute(c))b=[a];else return;for(a=0;a<b.length;a++){var e=b[a],f=e.getAttribute(c);null!==f&&d.call(this,e,f)}},elementAttrObjMap:function(a,c,b){for(var d in b){var e=b[d];this.elementAttrMap(a,
c,"key",function(a){this.setElementValue(a,d)});this.elementAttrMap(a,c,"prop",function(a,b){this.setElementValue(a,this.getPropFromStr(e,b))})}},setElementValue:function(a,c){var b=SchemaUtilities.determineValueAttr(a);return a[b]=c},getPropFromStr:function(a,c){var b=c.split(/\s+/),d=a;if(!(a instanceof Object))return a;for(var e=0;e<b.length;e++)d=d[b[e]];return d},getTplDir:function(){return this.schemaContext+this.tplDir},initStyles:function(){var a=document.createElement("link");a.setAttribute("rel",
"stylesheet");a.setAttribute("href",this.getTplDir()+"schema.css");return document.querySelector("head").appendChild(a)},loadResource:function(a,c){var b=this.newXmlHttpRequest();if(!b)return!1;var d=this;b.onreadystatechange=function(){d.__tplResponseCallback.call(d,b,a,c)};b.open("GET",a,!0);b.setRequestHeader("Content-type","application/x-www-form-urlencoded");b.send();return!1},__tplResponseCallback:function(a,c,b){if(4==a.readyState)if(200==a.status){this.xhrCache[c]=a.responseText;var d=document.createElement("div");
d.innerHTML=a.responseText;b.call(this,d.childNodes,a,c)}else throw Error("Error retrieving modal template. Response: "+a.status);},newXmlHttpRequest:function(){try{return new XMLHttpRequest}catch(a){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(b){return!1}}}}};return f}();var SchemaUtilities=function(){var f=function(){};f.prototype={itemHasNoParent:function(a){for(var c=!0;a&&(a=a.parentElement);)null!==a.getAttribute("itemtype")&&(c=a,a=null);return c},isPropInScope:function(a,c){for(var b=a,d=!1;b&&(b=b.parentElement);)null!==b.getAttribute("itemtype")&&(d=b==c.dom?!0:!1,b=null);return d},getPropertyValue:function(a){switch(a.tagName.toLowerCase()){case "meta":return a.getAttribute("content");case "input":return a.getAttribute("value");case "link":case "a":return a.getAttribute("href");
default:return a.innerHTML}},log:function(a){return console&&console[a]instanceof Function?console[a].apply(console,Array.prototype.splice.call(arguments,1)):!1},determineValueAttr:function(a){if(!a)return null;switch(a.nodeName){case "INPUT":return"value";case "IMG":case "SCRIPT":return"src";default:return"innerHTML"}}};return new f}();
